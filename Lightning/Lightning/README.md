# Бот Молния

## Описание проекта

Бот Молния - это интерактивный телеграм-бот для сбора информации о причинах увольнения сотрудников. Система позволяет проводить опросы на двух языках (русском и узбекском), собирать данные о подразделении, должности и причинах увольнения сотрудников.

## Архитектура проекта

Проект реализован на базе фреймворка Django с использованием библиотеки aiogram для работы с Telegram Bot API. Архитектура включает:

- **Админ-панель Django**: Для управления данными и просмотра результатов опросов
- **Телеграм-бот**: Для проведения опросов с пользователями
- **База данных PostgreSQL**: Для хранения результатов опросов и справочных данных

## Структура проекта
exit_bot/
├── manage.py # Основной скрипт управления Django
├── requirements.txt # Зависимости проекта
├── static/ # Статические файлы
├── ExitBot/ # Основной пакет проекта
│ ├── init.py
│ ├── settings.py # Настройки Django
│ ├── urls.py # URL маршруты
│ ├── asgi.py # ASGI конфигурация
│ ├── wsgi.py # WSGI конфигурация
│ ├── exit_module/ # Приложение для моделей опроса
│ │ ├── migrations/
│ │ ├── admin.py # Настройки админки
│ │ ├── apps.py
│ │ ├── models.py # Модели данных
│ │ ├── resources.py # Ресурсы для импорта/экспорта
│ │ ├── tests.py
│ │ └── views.py
│ └── bot/ # Приложение для телеграм-бота
│ ├── migrations/
│ ├── management/ # Команды управления
│ │ └── commands/
│ │ ├── bot.py # Запуск бота
│ │ └── handlers/
│ │ ├── init.py
│ │ ├── exitbot_logic.py # Логика бота
│ │ └── exitbot_kb.py # Клавиатуры бота
│ ├── admin.py
│ ├── apps.py
│ ├── models.py
│ ├── tests.py
│ └── views.py
└── .gitignore

## Модели данных

### ExitUser
Модель для хранения информации о пользователях Telegram, прошедших опрос:
- `telegram_id`: ID пользователя в Telegram

### Position
Модель для хранения должностей:
- `position_name_ru`: Название должности на русском
- `position_name_uz`: Название должности на узбекском

### Department
Модель для хранения подразделений:
- `department_name_ru`: Название подразделения на русском
- `department_name_uz`: Название подразделения на узбекском
- `positions`: Связь ManyToMany с моделью Position

### MainReason
Модель для хранения основных причин увольнения:
- `main_reason_name_ru`: Название причины на русском
- `main_reason_name_uz`: Название причины на узбекском

### SubReason
Модель для хранения подпричин увольнения:
- `main_reason`: Связь ForeignKey с MainReason
- `sub_reason_name_ru`: Детали причины на русском
- `sub_reason_name_uz`: Детали причины на узбекском

### SurveyResult
Модель для хранения результатов опроса:
- `telegram_id`: Связь ForeignKey с ExitUser
- `language`: Язык опроса (ru/uz)
- `position`: Связь ForeignKey с Position
- `department`: Связь ForeignKey с Department
- `main_reason`: Связь ForeignKey с MainReason
- `sub_reason`: Связь ForeignKey с SubReason
- `survey_date`: Дата и время прохождения опроса

## Логика работы Telegram-бота

Бот реализован с использованием библиотеки aiogram и имеет следующий поток работы:

1. **Начало опроса** (`/start`):
   - Проверка, проходил ли пользователь опрос ранее, если пользователь проходил опрос, то бот отклонит запрос на повторный опрос
   - Предложение выбрать язык опроса (русский/узбекский)

2. **Выбор языка**:
   - Сохранение выбранного языка
   - Переход к выбору подразделения

3. **Выбор подразделения**:
   - Отображение списка доступных подразделений
   - Сохранение выбранного подразделения
   - Переход к выбору должности

4. **Выбор должности**:
   - Отображение должностей, доступных в выбранном подразделении
   - Сохранение выбранной должности
   - Переход к подтверждению выбора

5. **Подтверждение выбора**:
   - Отображение сводки выбранных параметров
   - Возможность подтвердить или вернуться к началу

6. **Выбор основной причины увольнения**:
   - Отображение списка основных причин
   - Сохранение выбранной причины

7. **Выбор детальной причины увольнения**:
   - Отображение детальных причин, связанных с выбранной основной причиной
   - Сохранение выбранной детальной причины

8. **Завершение опроса**:
   - Сохранение результатов в базу данных/при необходимости возможность указать несколько причин (старт с шага 6)
   - Отправка благодарственного сообщения

## Администрирование

Проект использует Django Admin с улучшенным интерфейсом Jazzmin для управления данными. Основные функции администрирования:

- Управление списками подразделений и должностей
- Управление списками причин увольнения
- Просмотр и экспорт результатов опросов
- Настройка пользователей и прав доступа

## Технологический стек

- **Бэкенд**: Python 3.x, Django 4.2.16
- **База данных**: PostgreSQL
- **Телеграм API**: aiogram 3.11.0
- **Другие библиотеки**:
  - django-import-export для импорта/экспорта данных
  - django-jazzmin для улучшенного интерфейса администратора

## Настройка и запуск

### Переменные окружения (.env)
Для работы проекта необходимы следующие переменные окружения:
- `BOT_TOKEN`: Токен Telegram-бота
- `SECRET_KEY`: Секретный ключ Django
- `DEBUG`: Флаг режима отладки (True/False)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Миграции базы данных
```bash
python manage.py migrate
```

### Запуск бота
```bash
python manage.py bot
```

### Запуск сервера Django
```bash
python manage.py runserver
```

## Многоязычность

Проект поддерживает два языка интерфейса:
- Русский (ru)
- Узбекский (uz)

Все текстовые элементы в моделях и интерфейсе бота представлены на обоих языках.